<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="面试：怎么解决hash冲突？"/>




  <meta name="keywords" content="面试,hash冲突," />





  <link rel="alternate" href="/atom.xml" title="RiddleGo" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://riddlego.github.io/2021/07/31/面试：怎么解决hash冲突？/"/>


<meta name="description" content="Hash算法只是一个定义，并没有规定具体的实现 简述把任意长度的输入，通过Hash算法变换成固定长度的输出，这个输出就是Hash值。哈希值的空间远小于输入的空间，所以可能会发生“哈希碰撞”，即两个不同的输入，产生了同一个输出。Hash算法常用于消息摘要的场景 MD5、SHA都属于Hash算法的实现。 简单使用凡是涉及到分布式的系统，就会有负载均衡和数据分布的问题。为了让连接（或者数据）能够分布得更">
<meta property="og:type" content="article">
<meta property="og:title" content="面试：怎么解决hash冲突？">
<meta property="og:url" content="https://riddlego.github.io/2021/07/31/%E9%9D%A2%E8%AF%95%EF%BC%9A%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3hash%E5%86%B2%E7%AA%81%EF%BC%9F/index.html">
<meta property="og:site_name" content="RiddleGo">
<meta property="og:description" content="Hash算法只是一个定义，并没有规定具体的实现 简述把任意长度的输入，通过Hash算法变换成固定长度的输出，这个输出就是Hash值。哈希值的空间远小于输入的空间，所以可能会发生“哈希碰撞”，即两个不同的输入，产生了同一个输出。Hash算法常用于消息摘要的场景 MD5、SHA都属于Hash算法的实现。 简单使用凡是涉及到分布式的系统，就会有负载均衡和数据分布的问题。为了让连接（或者数据）能够分布得更">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/psycho1900/miss-reddle/raw/master/hash01.png">
<meta property="og:image" content="https://gitee.com/psycho1900/miss-reddle/raw/master/hash03.png">
<meta property="og:image" content="https://gitee.com/psycho1900/miss-reddle/raw/master/hash04.png">
<meta property="og:image" content="https://gitee.com/psycho1900/miss-reddle/raw/master/hash05.png">
<meta property="article:published_time" content="2021-07-31T08:09:40.000Z">
<meta property="article:modified_time" content="2021-07-31T11:08:10.582Z">
<meta property="article:author" content="Russshare">
<meta property="article:tag" content="面试">
<meta property="article:tag" content="hash冲突">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/psycho1900/miss-reddle/raw/master/hash01.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> 面试：怎么解决hash冲突？ - RiddleGo </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">RiddleGo</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          面试：怎么解决hash冲突？
        
      </h1>

      <time class="post-time">
          7月 31 2021
      </time>
    </header>



    
            <div class="post-content">
            <p>Hash算法只是一个定义，并没有规定具体的实现</p>
<h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p>把任意长度的输入，通过Hash算法变换成固定长度的输出，这个输出就是Hash值。哈希值的空间远小于输入的空间，所以可能会发生“哈希碰撞”，即两个不同的输入，产生了同一个输出。Hash算法常用于消息摘要的场景 MD5、SHA都属于Hash算法的实现。</p>
<h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><p>凡是涉及到分布式的系统，就会有负载均衡和数据分布的问题。为了让连接（或者数据）能够分布得更均匀，很多时候会使用到Hash算法。</p>
<h4 id="Hash取模-hash-request-n"><a href="#Hash取模-hash-request-n" class="headerlink" title="Hash取模 (hash(request) % n)"></a>Hash取模 (hash(request) % n)</h4><p>假设我们现在有3个服务器，想要做负载均衡，就可以对请求的ip地址或者用户的id等使用Hash函数，然后将计算得出的Hash值对3取模，余数为几，就把请求分配到相应的服务器上</p>
<p>缺点：如果新增服务器的时候，绝大多数请求基本上都需要重新映射到另一个节点。这种变动有时候是不能接受的。比如在Web负载均衡的场景下，session会保存在每个节点里。当然，如果你是“无状态”的服务，那不会存在这个问题。因为如果增加或者删除了一个节点，就会导致几乎所有的数据都需要重新迁移。</p>
<h4 id="一致性Hash"><a href="#一致性Hash" class="headerlink" title="一致性Hash"></a>一致性Hash</h4><p>优点：解决因为横向伸缩导致的大规模数据变动<br>上面说到用节点的数量作为除数去求余。而一致性Hash的除数是232。从0到232 - 1,首尾相连构成了一个环。我们先对服务器节点的IP进行Hash，然后除以2^32</p>
<p>得到服务器节点在这个Hash环中的位置。如果有请求进来了，同样进行Hash然后处于2^32求余。如果落在Hash环上，然后顺时针找到第一个节点，这个节点就负责处理这个请求。一致性Hash算法在节点数量较少的时候，会出现分布不均匀的问题<br>。解决这个问题的方案就是在Hash环上增加虚拟节点</p>
<h3 id="哈希表简介"><a href="#哈希表简介" class="headerlink" title="哈希表简介"></a>哈希表简介</h3><p><strong>非哈希表的特点</strong>：关键字在表中的位置和它之间不存在一个确定的关系，查找的过程为给定值一次和各个关键字进行比较，查找的效率取决于和给定值进行比较的次数。</p>
<p><strong>哈希表的特点</strong>：关键字在表中位置和它之间存在一种确定的关系。</p>
<p><strong>哈希函数</strong>：一般情况下，需要在关键字与它在表中的存储位置之间建立一个函数关系，以f(key)作为关键字为key的记录在表中的位置，通常称这个函数f(key)为哈希函数。</p>
<p><strong>hash</strong> ：翻译为“散列”，就是把任意长度的输入，通过散列算法，变成固定长度的输出，该输出就是散列值。这种转换是一种压缩映射，散列值的空间通常远小于输入的空间，不同的输入可能会散列成相同的输出，所以不可能从散列值来唯一的确定输入值。简单的说就是一种将任意长度的消息压缩到莫伊固定长度的消息摘要的函数。</p>
<p><strong>hash冲突</strong>：就是根据key即经过一个函数f(key)得到的结果的作为地址去存放当前的key value键值对(这个是hashmap的存值方式)，但是却发现算出来的地址上已经有人先来了。这就是所谓的hash冲突啦</p>
<h3 id="哈希函数处理冲突的方法"><a href="#哈希函数处理冲突的方法" class="headerlink" title="哈希函数处理冲突的方法"></a>哈希函数处理冲突的方法</h3><h4 id="开放定址法："><a href="#开放定址法：" class="headerlink" title="开放定址法："></a>开放定址法：</h4><p><img src="https://gitee.com/psycho1900/miss-reddle/raw/master/hash01.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">其中 m 为表的长度</span><br><span class="line">对增量di有三种取法</span><br><span class="line"></span><br><span class="line">1：线性探测再散列 di &#x3D; 1 , 2 , 3 , … , m-1</span><br><span class="line"></span><br><span class="line">2：平方探测再散列 di &#x3D; 1 , -1 , 2, -2 , 3 , -3 , … , k , -k(取相应数的平方)</span><br><span class="line"></span><br><span class="line">3: 随机探测再散列 di 是一组伪随机数列</span><br></pre></td></tr></table></figure>
<p>例子：</p>
<p><img src="https://gitee.com/psycho1900/miss-reddle/raw/master/hash03.png"></p>
<h4 id="链地址法"><a href="#链地址法" class="headerlink" title="链地址法"></a>链地址法</h4><p><img src="https://gitee.com/psycho1900/miss-reddle/raw/master/hash04.png"><br>先按照以上的hash算法：h(key) = key % 7，算出来对应的hash值，这个hash值暂时就决定，当前的这个值，存放在数组的位置。</p>
<p>这个做法就是Java的HashMap就是这么实现的，简单的解释下，这个HashMap源码的这个链表产生机制。<br>在put()方法里面，最后部分有个如下的调用。<br>addEntry(hash, key, value, i);<br>解释下几个参数的意思：</p>
<p>1，hash：就是根据key算出来的一个值，源码是这么滴–int hash = hash(key);，<br>2，key：key就是我们在往hashmap里面put键值对的时候的key<br>3，value：这个同上啦，就是存的键值对的值。<br>4，i：源码里面是这么滴–int i = indexFor(hash, table.length);实际意思就是这个键值对存放在底层数组的索引下标。然后这个i，可以对应到ppt上的那个取模之后的值，也就是确定在数组上的下标。<br>虽然在put的时候，可能会出现扩容的问题，但是在这咱就不考虑这个，只考虑如何生成链表，以及链表上的键值对的顺序。<br>createEntry(hash, key, value, bucketIndex);<br>这个方法就是真正的在创建一个节点到数组上。<br>再哈希、建立公共溢出区</p>
<h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://gitee.com/psycho1900/miss-reddle/raw/master/hash05.png"></h4><h4 id="总结一下的就是下面的四行字："><a href="#总结一下的就是下面的四行字：" class="headerlink" title="总结一下的就是下面的四行字："></a>总结一下的就是下面的四行字：</h4><p>1.开放定址法（线性探测再散列，二次探测再散列，伪随机探测再散列）<br>2.再哈希法<br>3.链地址法(Java hashmap就是这么做的)<br>4.建立一个公共溢出区</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yeiweilan/article/details/73412438?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-5.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-5.control">参考文章一</a></p>
<p><a target="_blank" rel="noopener" href="https://lixuekai.blog.csdn.net/article/details/52269862?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-4.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-4.control">参考文章二</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xtzmm1215/article/details/47177701?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-3.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-3.control">参考文章三</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/%E9%9D%A2%E8%AF%95/">面试</a>
		  
			<a href="/tags/hash%E5%86%B2%E7%AA%81/">hash冲突</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2021/07/31/%E9%9D%A2%E8%AF%95%EF%BC%9Agolang%E4%B8%AD%E7%9A%84map/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">面试：golang中的map</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2021/07/31/%E9%9D%A2%E8%AF%95%EF%BC%9Aredis/">
        <span class="next-text nav-default">面试：redis</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2021
    <span class="footer-author">Russshare.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> and <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
