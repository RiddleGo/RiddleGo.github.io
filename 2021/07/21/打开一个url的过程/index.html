<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="打开一个url的过程"/>




  <meta name="keywords" content="HTTP,计算机网络," />





  <link rel="alternate" href="/atom.xml" title="RiddleGo" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://riddlego.github.io/2021/07/21/打开一个url的过程/"/>


<meta name="description" content="原文链接很干货满满详细的一篇文章，谢谢前辈。 前言：最近面试美团，嗷呜面试官问我这个题，我老熟悉了，可是啊我当时懵逼状态没有get到他的点，就说了个吧域名转换成ip地址然后通过ip到了服务器，然后将资源再返回给客户端，晕了晕了。应该就是想引出TCP\IP的问题，可惜这个面试官的点我是一个都没有get到，嘤嘤嘤。  正文引言打开浏览器，在地址栏输入URL，回车，出现网页内容。整个过程发生了什么？其中">
<meta property="og:type" content="article">
<meta property="og:title" content="打开一个url的过程">
<meta property="og:url" content="https://riddlego.github.io/2021/07/21/%E6%89%93%E5%BC%80%E4%B8%80%E4%B8%AAurl%E7%9A%84%E8%BF%87%E7%A8%8B/index.html">
<meta property="og:site_name" content="RiddleGo">
<meta property="og:description" content="原文链接很干货满满详细的一篇文章，谢谢前辈。 前言：最近面试美团，嗷呜面试官问我这个题，我老熟悉了，可是啊我当时懵逼状态没有get到他的点，就说了个吧域名转换成ip地址然后通过ip到了服务器，然后将资源再返回给客户端，晕了晕了。应该就是想引出TCP\IP的问题，可惜这个面试官的点我是一个都没有get到，嘤嘤嘤。  正文引言打开浏览器，在地址栏输入URL，回车，出现网页内容。整个过程发生了什么？其中">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-07-21T11:40:59.000Z">
<meta property="article:modified_time" content="2021-07-21T12:39:05.814Z">
<meta property="article:author" content="Russshare">
<meta property="article:tag" content="HTTP">
<meta property="article:tag" content="计算机网络">
<meta name="twitter:card" content="summary">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> 打开一个url的过程 - RiddleGo </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">RiddleGo</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          打开一个url的过程
        
      </h1>

      <time class="post-time">
          7月 21 2021
      </time>
    </header>



    
            <div class="post-content">
            <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012862311/article/details/78753232">原文链接</a><br>很干货满满详细的一篇文章，谢谢前辈。</p>
<h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>最近面试美团，嗷呜面试官问我这个题，我老熟悉了，可是啊我当时懵逼状态没有get到他的点，就说了个吧域名转换成ip地址然后通过ip到了服务器，然后将资源再返回给客户端，晕了晕了。应该就是想引出TCP\IP的问题，可惜这个面试官的点我是一个都没有get到，嘤嘤嘤。 </p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>打开浏览器，在地址栏输入URL，回车，出现网页内容。整个过程发生了什么？其中的原理是什么？以下进行整理和总结。</p>
<p>整个过程可以概括为几下几个部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">域名解析成IP地址；</span><br><span class="line"></span><br><span class="line">与目的主机进行TCP连接（三次握手）；---建立链接</span><br><span class="line"></span><br><span class="line">发送与收取数据（浏览器与目的主机开始HTTP访问过程）；建立了TCP链接就建立HTTP链接</span><br><span class="line"></span><br><span class="line">与目的主机断开TCP连接（四次挥手）；---断开链接</span><br></pre></td></tr></table></figure>
<h3 id="正文-1"><a href="#正文-1" class="headerlink" title="正文"></a>正文</h3><p>下面详细介绍其中的原理：</p>
<h4 id="1-域名解析成IP地址"><a href="#1-域名解析成IP地址" class="headerlink" title="1. 域名解析成IP地址"></a>1. 域名解析成IP地址</h4><p>访问目标地址有两种方式：</p>
<h5 id="①使用目标IP地址访问。"><a href="#①使用目标IP地址访问。" class="headerlink" title="①使用目标IP地址访问。"></a>①使用目标IP地址访问。</h5><p>由于IP地址是一堆数字不方便记忆，于是有了域名这种字符型标识。</p>
<h5 id="②使用域名访问。"><a href="#②使用域名访问。" class="headerlink" title="②使用域名访问。"></a>②使用域名访问。</h5><p>域名解析就是域名到IP地址的转换过程，域名的解析工作由DNS服务器完成。</p>
<p>DNS域名解析时用的是UDP协议。整个域名解析的过程如下：</p>
<ul>
<li><p>浏览器向本机DNS模块发出DNS请求，DNS模块生成相关的DNS报文；</p>
</li>
<li><p>DNS模块将生成的DNS报文传递给传输层的UDP协议单元；</p>
</li>
<li><p>UDP协议单元将该数据封装成UDP数据报，传递给网络层的IP协议单元；</p>
</li>
<li><p>IP协议单元将该数据封装成IP数据包，其目的IP地址为DNS服务器的IP地址；</p>
</li>
<li><p>封装好的IP数据包将传递给数据链路层的协议单元进行发送；</p>
</li>
<li><p>发送时在ARP缓存中查询相关数据，如果没有，就发送ARP广播（包含待查询的IP地址，收到广播的主机检查自己的IP，符合条件的主机将含有自己MAC地址的ARP包发送给ARP广播的主机）请求，等待ARP回应；</p>
</li>
<li><p>得到ARP回应后，将IP地址与路由的下一跳MAC地址对应的信息写入ARP缓存表；</p>
</li>
<li><p>写入缓存后，以路由下一跳的地址填充目的MAC地址，以数据帧形式转发；</p>
</li>
<li><p>转发可能进行多次；</p>
</li>
<li><p>DNS请求到达DNS服务器的数据链路层协议单元；</p>
</li>
<li><p>DNS服务器的数据链路层协议单元解析数据帧，将内部的IP数据包传递给网络层IP协议单元；</p>
</li>
<li><p>DNS服务器的IP协议单元解析IP数据包，将内部的UDP数据报传递给传输层UDP协议单元；</p>
</li>
<li><p>DNS服务器的UDP协议单元解析收到的UDP数据报，将内部的DNS报文传递给DNS服务单元；</p>
</li>
<li><p>DNS服务单元将域名解析成对应IP地址，产生DNS回应报文；</p>
</li>
<li><p>DNS回应报文-&gt;UDP-&gt;IP-&gt;MAC-&gt;我的主机；</p>
</li>
<li><p>我的主机收到数据帧，将数据帧-&gt;IP-&gt;UDP-&gt;浏览器；</p>
</li>
<li><p>将域名解析结果以域名和IP地址对应的形式写入DNS缓存表。</p>
</li>
</ul>
<h4 id="与目的主机进行TCP连接（三次握手）"><a href="#与目的主机进行TCP连接（三次握手）" class="headerlink" title="与目的主机进行TCP连接（三次握手）"></a>与目的主机进行TCP连接（三次握手）</h4><p>向目的主机发送TCP连接请求报文；</p>
<p>该TCP报文中SYN标志位设为1，表示连接请求；</p>
<p>该TCP报文通过IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;目的主机；</p>
<p>目的主机收到数据帧，通过IP-&gt;TCP，TCP协议单元回应请求应答报文；</p>
<p>该报文中SYN和ACK标志设为1，表示连接请求应答；</p>
<p>该TCP报文通过IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;我的主机；</p>
<p>我的主机收到数据帧，通过IP-&gt;TCP，TCP协议单元回应请求确认报文；</p>
<p>该TCP报文通过IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;目的主机；</p>
<p>目的主机收到数据帧，通过IP-&gt;TCP，连接建立完成。</p>
<h4 id="发送与收取数据（浏览器与目的主机开始HTTP访问过程）"><a href="#发送与收取数据（浏览器与目的主机开始HTTP访问过程）" class="headerlink" title="发送与收取数据（浏览器与目的主机开始HTTP访问过程）"></a>发送与收取数据（浏览器与目的主机开始HTTP访问过程）</h4><p>只有建立连接后才能开始传输数据。</p>
<p>浏览器向域名发出GET方法报文（HTTP请求）；</p>
<p>该GET方法报文通过TCP-&gt;IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;目的主机；</p>
<p>目的主机收到数据帧，通过IP-&gt;TCP-&gt;HTTP，HTTP协议单元会回应HTTP协议格式封装好的HTML形式数据（HTTP响应）；<br>[<br>  从请求信息中获得客户机想访问的主机名。</p>
<p>  从请求信息中获取客户机想要访问的web应用（web应用程序指提供浏览器访问的程序，简称web应用）。</p>
<p>  从请求信息中获取客户机要访问的web资源。（web资源，即各种文件，图片，视频，文本等）读取相应的主机下的web应用，web资源。</p>
<p>  用读取到的web资源数据，创建一个HTTP响应。]</p>
<p>该HTML数据通过TCP-&gt;IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;我的主机；</p>
<p>我的主机收到数据帧，通过IP-&gt;TCP-&gt;HTTP-&gt;浏览器，浏览器以网页形式显示HTML内容。</p>
<h4 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h4><p>HTTP请求由三部分组成，分别是：请求行、消息报头、请求正文</p>
<p>请求行以一个方法符号开头，以空格分开，后面跟着请求的URI和协议的版本，</p>
<p>格式如下：Method Request-URI HTTP-Version CRLF  </p>
<p>其中 Method表示请求方法；Request-URI是一个统一资源标识符；</p>
<p>HTTP-Version表示请求的HTTP协议版本；</p>
<p>CRLF表示回车和换行（除了作为结尾的CRLF外，不允许出现单独的CR或LF字符）。</p>
<h5 id="请求方法（所有方法全为大写）有多种，各个方法的解释如下："><a href="#请求方法（所有方法全为大写）有多种，各个方法的解释如下：" class="headerlink" title="请求方法（所有方法全为大写）有多种，各个方法的解释如下："></a>请求方法（所有方法全为大写）有多种，各个方法的解释如下：</h5><p>GET     请求获取Request-URI所标识的资源<br>POST    在Request-URI所标识的资源后附加新的数据<br>HEAD    请求获取由Request-URI所标识的资源的响应消息报头<br>PUT     请求服务器存储一个资源，并用Request-URI作为其标识<br>DELETE  请求服务器删除Request-URI所标识的资源<br>TRACE   请求服务器回送收到的请求信息，主要用于测试或诊断<br>CONNECT 保留将来使用<br>OPTIONS 请求查询服务器的性能，或者查询与资源相关的选项和需求<br>HTTP响应也是由三个部分组成，分别是：状态行、消息报头、响应正文</p>
<h5 id="状态行格式如下："><a href="#状态行格式如下：" class="headerlink" title="状态行格式如下："></a>状态行格式如下：</h5><p>HTTP-Version Status-Code Reason-Phrase CRLF,  eg：HTTP/1.1 200 OK （CRLF）</p>
<p>其中，HTTP-Version表示服务器HTTP协议的版本；</p>
<p>Status-Code表示服务器发回的响应状态代码；</p>
<p>Reason-Phrase表示状态代码的文本描述。</p>
<p>状态代码有三位数字组成，第一个数字定义了响应的类别，且有五种可能取值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1xx：指示信息--表示请求已接收，继续处理</span><br><span class="line">2xx：成功--表示请求已被成功接收、理解、接受</span><br><span class="line">3xx：重定向--要完成请求必须进行更进一步的操作</span><br><span class="line">4xx：客户端错误--请求有语法错误或请求无法实现</span><br><span class="line">5xx：服务器端错误--服务器未能实现合法的请求</span><br></pre></td></tr></table></figure>
<p>常见状态代码、状态描述、说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">200 OK      &#x2F;&#x2F;客户端请求成功</span><br><span class="line">400 Bad Request  &#x2F;&#x2F;客户端请求有语法错误，不能被服务器所理解</span><br><span class="line">401 Unauthorized &#x2F;&#x2F;请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用 </span><br><span class="line">403 Forbidden  &#x2F;&#x2F;服务器收到请求，但是拒绝提供服务</span><br><span class="line">404 Not Found  &#x2F;&#x2F;请求资源不存在，eg：输入了错误的URL</span><br><span class="line">500 Internal Server Error &#x2F;&#x2F;服务器发生不可预期的错误</span><br><span class="line">503 Server Unavailable  &#x2F;&#x2F;服务器当前不能处理客户端的请求，一段时间</span><br><span class="line">后可能恢复正常</span><br></pre></td></tr></table></figure>

<h5 id="消息报头"><a href="#消息报头" class="headerlink" title="消息报头"></a>消息报头</h5><p>常用的请求报头</p>
<p><strong>Accept</strong></p>
<p>Accept请求报头域用于指定客户端接受哪些类型的信息。eg：Accept：image/gif，表明客户端希望接受GIF图象格式的资源；Accept：text/html，表明客户端希望接受html文本。</p>
<p><strong>Accept-Charset</strong></p>
<p>Accept-Charset请求报头域用于指定客户端接受的字符集。eg：Accept-Charset:iso-8859-1,gb2312.如果在请求消息中没有设置这个域，缺省是任何字符集都可以接受。</p>
<p><strong>Accept-Encoding</strong></p>
<p>Accept-Encoding请求报头域类似于Accept，但是它是用于指定可接受的内容编码。eg：Accept-Encoding:gzip.deflate.如果请求消息中没有设置这个域服务器假定客户端对各种内容编码都可以接受。</p>
<p><strong>Accept-Language</strong></p>
<p>Accept-Language请求报头域类似于Accept，但是它是用于指定一种自然语言。eg：Accept-Language:zh-cn.如果请求消息中没有设置这个报头域，服务器假定客户端对各种语言都可以接受。</p>
<p><strong>Authorization</strong></p>
<p>Authorization请求报头域主要用于证明客户端有权查看某个资源。当浏览器访问一个页面时，如果收到服务器的响应代码为401（未授权），可以发送一个包含Authorization请求报头域的请求，要求服务器对其进行验证。</p>
<p><strong>Host</strong>（发送请求时，该报头域是必需的）</p>
<p>Host请求报头域主要用于指定被请求资源的Internet主机和端口号，它通常从HTTP URL中提取出来的，</p>
<p>eg：我们在浏览器中输入：<a target="_blank" rel="noopener" href="http://www.guet.edu.cn/index.html">http://www.guet.edu.cn/index.html</a></p>
<p>浏览器发送的请求消息中，就会包含Host请求报头域，如下：</p>
<p>Host：<a target="_blank" rel="noopener" href="http://www.guet.edu.cn/">www.guet.edu.cn</a></p>
<p>此处使用缺省端口号80，若指定了端口号，则变成：Host：<a href="http://www.guet.edu.cn:指定端口号">www.guet.edu.cn:指定端口号</a></p>
<p><strong>User-Agent</strong></p>
<p>User-Agent请求报头域允许客户端将它的操作系统、浏览器和其它属性告诉服务器。这个报头域不是必需的。</p>
<h5 id="常用的响应报头"><a href="#常用的响应报头" class="headerlink" title="常用的响应报头"></a>常用的响应报头</h5><p><strong>Location</strong><br>Location响应报头域用于重定向接受者到一个新的位置。Location响应报头域常用在更换域名的时候。</p>
<p><strong>Server</strong><br>Server响应报头域包含了服务器用来处理请求的软件信息。与User-Agent请求报头域是相对应的。下面是Server响应报头域的一个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server：Apache-Coyote&#x2F;1.1</span><br></pre></td></tr></table></figure>

<p><strong>WWW-Authenticate</strong></p>
<p>WWW-Authenticate响应报头域必须被包含在401（未授权的）响应消息中，客户端收到401响应消息时候，并发送Authorization报头域请求服务器对其进行验证时，服务端响应报头就包含该报头域。</p>
<p>eg：WWW-Authenticate:Basic realm=”Basic Auth Test!”  //可以看出服务器对请求资源采用的是基本验证机制。</p>
<p>HTTP协议详解，可阅读：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/li0803/archive/2008/11/03/1324746.html">http://www.cnblogs.com/li0803/archive/2008/11/03/1324746.html</a></p>
<h3 id="与目的主机断开TCP连接（四次挥手）"><a href="#与目的主机断开TCP连接（四次挥手）" class="headerlink" title="与目的主机断开TCP连接（四次挥手）"></a>与目的主机断开TCP连接（四次挥手）</h3><h3 id="TCP连接释放过程："><a href="#TCP连接释放过程：" class="headerlink" title="TCP连接释放过程："></a>TCP连接释放过程：</h3><p>浏览器向目的主机发出TCP连接结束请求报文，此时进入FIN WAIT状态；<br>该报文FIN标志位设为1，表示结束请求；</p>
<p>TCP结束请求报文通过IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;目的主机；</p>
<p>目的主机收到数据帧，通过IP-&gt;TCP，TCP协议单元回应结束应答报文；</p>
<p>当前只是进行回应，因为目的主机可能还有数据要传，并不急着断开连接；</p>
<p>该报文中ACK标志位设为1，表示收到结束请求；</p>
<p>目的数据发送完所有数据后，向我的主机发出TCP连接结束请求报文；</p>
<p>该报文FIN标志位设为1，表示结束请求；</p>
<p>TCP结束请求报文通过IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;我的主机；</p>
<p>我的主机收到数据帧，通过IP-&gt;TCP，TCP协议单元回应结束应答报文，此时进入TIME WAIT状态，因为不相信网络是可靠的，如果目的主机没收到还可以重发；</p>
<p>该报文中的FIN标志位均设为1，表示结束应答；</p>
<p>该TCP回应报文通过IP（DNS）-&gt;MAC（ARP）-&gt;网关-&gt;目的主机；</p>
<p>目的主机关闭连接；</p>
<p>TIME WAIT等待结束后，没有收到回复，说明目的正常关闭了，我的主机也关闭连接。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>URL访问网站时的网络传输全过程，可以归纳为：</strong></p>
<p>首先通过域名找到IP，如果缓存里没有就要请求DNS服务器；</p>
<p>得到IP后开始与目的主机进行三次握手来建立TCP连接；</p>
<p>连接建立后进行HTTP访问，传输并获取网页内容；</p>
<p>传输完后与目的主机四次挥手来断开TCP连接。</p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/HTTP/">HTTP</a>
		  
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2021/07/21/golang%E4%B8%AD%E7%9A%84slice/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">golang中的slice</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2021/07/21/what-is-restful/">
        <span class="next-text nav-default">what-is-restful</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2021
    <span class="footer-author">Russshare.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> and <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
