<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="听风说你来自远方"><title>Go应用优化指北 | RiddleGo</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Go应用优化指北</h1><a id="logo" href="/.">RiddleGo</a><p class="description">小时候想以后做个作家</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Go应用优化指北</h1><div class="post-meta">2021-08-22<span> | </span><span class="category"><a href="/categories/golang-More/">golang-More</a><a href="/categories/golang-More/%E4%BC%98%E5%8C%96/">优化</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%81%9A%E4%BC%98%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">为什么要做优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">优化的前置知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E8%B6%8A%E9%9D%A0%E8%BF%91%E5%BA%94%E7%94%A8%E5%B1%82%E6%95%88%E6%9E%9C%E8%B6%8A%E5%A5%BD"><span class="toc-number">3.</span> <span class="toc-text">优化越靠近应用层效果越好</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%98%AF%E4%B8%8E%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E7%9B%B8%E5%85%B3%E7%9A%84"><span class="toc-number">4.</span> <span class="toc-text">优化是与业务场景相关的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">优化的工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">6.</span> <span class="toc-text">可以使用的工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pprof"><span class="toc-number">6.1.</span> <span class="toc-text">pprof</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#memory-profiler"><span class="toc-number">6.1.1.</span> <span class="toc-text">memory profiler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cpu-profiler"><span class="toc-number">6.1.2.</span> <span class="toc-text">cpu profiler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fgprof"><span class="toc-number">6.1.3.</span> <span class="toc-text">fgprof</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trace"><span class="toc-number">6.1.4.</span> <span class="toc-text">trace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#perf"><span class="toc-number">6.1.5.</span> <span class="toc-text">perf</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E8%A7%82%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text">微观性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8F%E8%A7%82%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">8.</span> <span class="toc-text">宏观性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88"><span class="toc-number">9.</span> <span class="toc-text">寻找性能瓶颈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B"><span class="toc-number">10.</span> <span class="toc-text">一些优化案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gc-mark-%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A-CPU"><span class="toc-number">10.1.</span> <span class="toc-text">gc mark 占用过多 CPU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E5%8F%98%E9%87%8F%E9%80%83%E9%80%B8"><span class="toc-number">10.2.</span> <span class="toc-text">减少变量逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-sync-Pool-%E5%A4%8D%E7%94%A8%E5%A0%86%E4%B8%8A%E5%AF%B9%E8%B1%A1"><span class="toc-number">10.3.</span> <span class="toc-text">使用 sync.Pool 复用堆上对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A-CPU"><span class="toc-number">10.4.</span> <span class="toc-text">调度占用过多 CPU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%8D%A0%E7%94%A8%E5%A4%A7%E9%87%8F%E5%86%85%E5%AD%98"><span class="toc-number">10.5.</span> <span class="toc-text">进程占用大量内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E5%86%B2%E7%AA%81%E4%B8%A5%E9%87%8D%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%90%9E%E5%90%90%E9%87%8F%E7%93%B6%E9%A2%88"><span class="toc-number">10.6.</span> <span class="toc-text">锁冲突严重，导致吞吐量瓶颈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#timer-%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E5%8D%A0%E7%94%A8%E5%A4%A7%E9%87%8F-CPU"><span class="toc-number">10.7.</span> <span class="toc-text">timer 相关函数占用大量 CPU</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E7%9C%9F%E5%AE%9E%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD"><span class="toc-number">11.</span> <span class="toc-text">模拟真实工作负载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D%E5%B7%A5%E5%85%B7%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">12.</span> <span class="toc-text">当前性能问题定位工具的局限性</span></a></li></ol></div></div><div class="post-content"><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/X7OU9JjSThB5IZF_KVT1Jg">全文来自曹大微信公众号–点击进入原文</a></p>
<p>真的太建议大家好好阅读一下曹大的文章，我们学生因为没有在工作中接触真正的业务，曹大总能把很厉害的实际的技术讲的很通透。瑞思拜。</p>
<h2 id="为什么要做优化"><a href="#为什么要做优化" class="headerlink" title="为什么要做优化"></a>为什么要做优化</h2><p>这是一个速度决定一切的时代，我们的生活在不断地数字化，线下的流程依然在持续向线上转移，转移过程中，作为工程师，我们会碰到各种各样的性能问题。</p>
<p>互联网公司本质是将用户共通的行为流程进行了集中化管理，通过中心化的信息交换达到效率提升的目的，同时用规模效应降低了数据交换的成本。</p>
<p>用人话来讲，公司希望的是用尽量少的机器成本来赚取尽量多的利润。利润的提升与业务逻辑本身相关，与技术关系不大。而降低成本则是与业务无关，纯粹的技术话题。这里面最重要的主题就是“性能优化”。</p>
<p>如果业务的后端服务规模足够大，那么一个程序员通过优化帮公司节省的成本，就可以负担他十年的工资了。</p>
<h2 id="优化的前置知识"><a href="#优化的前置知识" class="headerlink" title="优化的前置知识"></a>优化的前置知识</h2><p>从资源视角出发来对一台服务器进行审视的话，<strong>CPU、内存、磁盘与网络</strong>是后端服务最需要关注的四种资源类型。</p>
<p>对于<strong>计算密集型的程序来说，优化的主要精力会放在 CPU 上，要知道 CPU 基本的流水线概念，知道怎么样在使用少的 CPU 资源的情况下，达到相同的计算目标。</strong></p>
<p>对于 <strong>IO 密集型的程序(后端服务一般都是 IO 密集型)来说，优化可以是降低程序的服务延迟，也可以是提升系统整体的吞吐量。</strong></p>
<p><strong>IO 密集型应用主要与磁盘、内存、网络打交道</strong>。因此我们需要知道一些基本的与磁盘、内存、网络相关的基本数据与常见概念：</p>
<ul>
<li><p>要了解内存的多级存储结构：L1，L2，L3，主存。还要知道这些不同层级的存储操作时的大致延迟：latency numbers every programmer should know[1]。</p>
</li>
<li><p>要知道基本的文件系统读写 syscall，批量 syscall，数据同步 syscall。</p>
</li>
<li><p>要熟悉项目中使用的网络协议，至少要对 TCP, HTTP 有所了解。</p>
</li>
</ul>
<h2 id="优化越靠近应用层效果越好"><a href="#优化越靠近应用层效果越好" class="headerlink" title="优化越靠近应用层效果越好"></a>优化越靠近应用层效果越好</h2><hr>
<p>Performance tuning is most effective when done closest to where the work is performed. For workloads driven by applications, this means within the application itself.</p>
<p>我们在应用层的逻辑优化能够帮助应用提升几十倍的性能，而最底层的优化则只能提升几个百分点。</p>
<p>这个很好理解，我们可以看到一个 GTA Online 的新闻：<strong>rockstar thanks gta online player who fixed poor load times</strong>[2]。</p>
<p>简单来说，GTA online 的游戏启动过程让玩家等待时间过于漫长，经过各种工具分析，发现一个 10M 的文件加载就需要几十秒，用户 diy 进行优化之后，将加载时间减少 70%，并分享出来：how I cut GTA Online loading times by 70%[3]。</p>
<p>这就是一个非常典型的案例，GTA 在商业上取得了巨大的成功，但不妨碍它局部的代码是一坨屎。我们只要把这里的重复逻辑干掉，就可以完成三倍的优化效果。同样的案例，如果我们去优化磁盘的读写速度，则可能收效甚微。</p>
<h2 id="优化是与业务场景相关的"><a href="#优化是与业务场景相关的" class="headerlink" title="优化是与业务场景相关的"></a>优化是与业务场景相关的</h2><p>不同的业务场景优化的侧重也是不同的。</p>
<p><strong>对于大多数无状态业务模块来说，内存一般不是瓶颈，所以业务 API 的优化主要聚焦于延迟和吞吐。<strong><strong>对于网关类的应用，因为有海量的连接，除了延迟和吞吐，内存占用可能就会成为一个关注的重点。</strong></strong>对于存储类应用，内存是个逃不掉的瓶颈点。</strong></p>
<p>在关注一些性能优化文章时，我们也应特别留意作者的业务场景。场景的侧重可能会让某些人去选择使用更为 hack 的手段进行优化，而 hack 往往也就意味着 bug。如果你选择了少有人走过的路，那你要面临的也是少有人会碰到的 bug。解决起来令人头疼。</p>
<h2 id="优化的工作流程"><a href="#优化的工作流程" class="headerlink" title="优化的工作流程"></a>优化的工作流程</h2><p>对于一个典型的 API 应用来说，优化工作基本遵从下面的工作流：</p>
<p>1、建立评估指标，例如固定 QPS 压力下的延迟或内存占用，或模块在满足 SLA 前提下的极限 QPS</p>
<p>2、通过自研、开源压测工具进行压测，直到模块无法满足预设性能要求:如大量超时，QPS 不达预期，OOM</p>
<p>3、通过内置 profile 工具寻找性能瓶颈</p>
<p>4、本地 benchmark 证明优化效果</p>
<p>5、集成 patch 到业务模块，回到 2</p>
<h2 id="可以使用的工具"><a href="#可以使用的工具" class="headerlink" title="可以使用的工具"></a>可以使用的工具</h2><h3 id="pprof"><a href="#pprof" class="headerlink" title="pprof"></a>pprof</h3><h4 id="memory-profiler"><a href="#memory-profiler" class="headerlink" title="memory profiler"></a>memory profiler</h4><p>Go 内置的内存 profiler 可以让我们对线上系统进行内存使用采样，有四个相应的指标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">inuse_objects：当我们认为内存中的驻留对象过多时，就会关注该指标</span><br><span class="line"></span><br><span class="line">inuse_space：当我们认为应用程序占据的 RSS 过大时，会关注该指标</span><br><span class="line"></span><br><span class="line">alloc_objects：当应用曾经发生过历史上的大量内存分配行为导致 CPU 或内存使用大幅上升时，可能关注该指标</span><br><span class="line"></span><br><span class="line">alloc_space：当应用历史上发生过内存使用大量上升时，会关注该指标</span><br></pre></td></tr></table></figure>

<p><strong>网关类应用因为海量连接的关系，会导致进程消耗大量内存，</strong>所以我们经常看到相关的优化文章，主要就是降低应用的 inuse_space。</p>
<p><strong>而两个对象数指标主要是为 GC 优化提供依据，</strong>当我们进行 GC 调优时，会同时关注<strong>应用分配的对象数、****正在使用的对象数</strong>，<strong>以及 GC 的 CPU 占用的指标。</strong></p>
<p>GC 的 CPU 占用情况可以由内置的 CPU profiler 得到。</p>
<h4 id="cpu-profiler"><a href="#cpu-profiler" class="headerlink" title="cpu profiler"></a>cpu profiler</h4><hr>
<p>The builtin Go CPU profiler uses the setitimer(2) system call to ask the operating system to be sent a SIGPROF signal 100 times a second. Each signal stops the Go process and gets delivered to a random thread’s sigtrampgo() function. This function then proceeds to call sigprof() or sigprofNonGo() to record the thread’s current stack.</p>
<p>Go 语言内置的 CPU profiler 使用 setitimer 系统调用，操作系统会每秒 100 次向程序发送 SIGPROF 信号。在 Go 进程中会选择随机的信号执行 sigtrampgo 函数。该函数使用 sigprof 或 sigprofNonGo 来记录线程当前的栈。</p>
<p>Since Go uses non-blocking I/O, Goroutines that wait on I/O are parked and not running on any threads. Therefore they end up being largely invisible to Go’s builtin CPU profiler.</p>
<p>Go 语言内置的 cpu profiler 是在性能领域比较常见的 On-CPU profiler，对于瓶颈主要在 CPU 消耗的应用，我们使用内置的 profiler 也就足够了。</p>
<p>如果碰到的问题是应用的 CPU 使用不高，但接口的延迟却很大，那么就需要用上 Off-CPU profiler，遗憾的是官方的 profiler 并未提供该功能，我们需要借助社区的 fgprof。</p>
<h4 id="fgprof"><a href="#fgprof" class="headerlink" title="fgprof"></a>fgprof</h4><hr>
<p>gprof is implemented as a background goroutine that wakes up 99 times per second and calls runtime.GoroutineProfile. This returns a list of all goroutines regardless of their current On/Off CPU scheduling status and their call stacks.</p>
<p>fgprof 是启动了一个后台的 goroutine，每秒启动 99 次，调用 runtime.GoroutineProfile 来采集所有 gorooutine 的栈。</p>
<p>虽然看起来很美好：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">func GoroutineProfile(p []StackRecord) (n int, ok bool) &#123;</span><br><span class="line">    .....</span><br><span class="line"> stopTheWorld(&quot;profile&quot;)</span><br><span class="line"></span><br><span class="line"> for _, gp1 :&#x3D; range allgs &#123;</span><br><span class="line">  ......</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> if n &lt;&#x3D; len(p) &#123;</span><br><span class="line">  &#x2F;&#x2F; Save current goroutine.</span><br><span class="line">  ........</span><br><span class="line">  systemstack(func() &#123;</span><br><span class="line">   saveg(pc, sp, gp, &amp;r[0])</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; Save other goroutines.</span><br><span class="line">  for _, gp1 :&#x3D; range allgs &#123;</span><br><span class="line">   if isOK(gp1) &#123;</span><br><span class="line">    .......</span><br><span class="line">    saveg(^uintptr(0), ^uintptr(0), gp1, &amp;r[0])</span><br><span class="line">                .......</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> startTheWorld()</span><br><span class="line"></span><br><span class="line"> return n, ok</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但调用 GoroutineProfile 函数的开销并不低，如果线上系统的 goroutine 上万，每次采集 profile 都遍历上万个 goroutine 的成本实在是太高了。所以 fgprof 只适合在测试环境中使用。</p>
<h4 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h4><p>一般情况下我们是不需要使用 trace 来定位性能问题的，通过压测 + profile 就可以解决大部分问题，除非我们的问题与 runtime 本身的问题相关。</p>
<p>比如 STW 时间比预想中长，超过百毫秒，向官方反馈问题时，才需要出具相关的 trace 文件。比如类似 long stw[4] 这样的 issue。</p>
<p>采集 trace 对系统的性能影响还是比较大的，即使我们只是开启 gctrace，把 gctrace 日志重定向到文件，对系统延迟也会有一定影响，因为 gctrace 的日志 print 是在 stw 期间来做的：gc trace 阻塞调度[5]。</p>
<h4 id="perf"><a href="#perf" class="headerlink" title="perf"></a>perf</h4><p>如果应用没有开启 pprof，在线上应急时，我们也可以临时使用 perf：</p>
<p><img src="https://gitee.com/psycho1900/miss-reddle/raw/master/process/%E4%BC%98%E5%8C%9601.png"></p>
<h2 id="微观性能优化"><a href="#微观性能优化" class="headerlink" title="微观性能优化"></a>微观性能优化</h2><p>编写 library 时会关注关键函数的性能，这时可以脱离系统去探讨性能优化，Go 语言的 test 子命令集成了相关的功能，<strong>只要我们按照约定来写 Benchmark 前缀的测试函数</strong>，就可以实现函数级的基准测试。我们以常见的二维数组遍历为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;testing&quot;</span><br><span class="line"></span><br><span class="line">var x &#x3D; make([][]int, 100)</span><br><span class="line"></span><br><span class="line">func init() &#123;</span><br><span class="line"> for i :&#x3D; 0; i &lt; 100; i++ &#123;</span><br><span class="line">  x[i] &#x3D; make([]int, 100)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func traverseVertical() &#123;</span><br><span class="line"> for i :&#x3D; 0; i &lt; 100; i++ &#123;</span><br><span class="line">  for j :&#x3D; 0; j &lt; 100; j++ &#123;</span><br><span class="line">   x[j][i] &#x3D; 1</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func traverseHorizontal() &#123;</span><br><span class="line"> for i :&#x3D; 0; i &lt; 100; i++ &#123;</span><br><span class="line">  for j :&#x3D; 0; j &lt; 100; j++ &#123;</span><br><span class="line">   x[i][j] &#x3D; 1</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BenchmarkHorizontal(b *testing.B) &#123;</span><br><span class="line"> for i :&#x3D; 0; i &lt; b.N; i++ &#123;</span><br><span class="line">  traverseHorizontal()</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BenchmarkVertical(b *testing.B) &#123;</span><br><span class="line"> for i :&#x3D; 0; i &lt; b.N; i++ &#123;</span><br><span class="line">  traverseVertical()</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行 go test -bench=.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkHorizontal-12       102368      10916 ns&#x2F;op</span><br><span class="line">BenchmarkVertical-12          66612      18197 ns&#x2F;op</span><br></pre></td></tr></table></figure>
<p><strong>可见横向遍历数组要快得多，这提醒我们在写代码时要考虑 CPU 的 cache 设计及局部性原理，以使程序能够在相同的逻辑下获得更好的性能。</strong></p>
<p>除了 CPU 优化，我们还经常会碰到要优化内存分配的场景。只要带上 -benchmem 的 flag 就可以实现了。</p>
<p>举个例子，形如下面这样的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logStr :&#x3D; &quot;userid :&quot; + userID + &quot;; orderid:&quot; + orderID</span><br></pre></td></tr></table></figure>
<p>你觉得代码写的很难看，想要优化一下可读性，就改成了下列代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logStr :&#x3D; fmt.Sprintf(&quot;userid: %v; orderid: %v&quot;, userID, orderID)</span><br></pre></td></tr></table></figure>

<p>这样的修改方式在某公司的系统中曾经导致了 p2 事故，上线后接口的超时俱增至 SLA 承诺以上。</p>
<p>我们简单验证就可以发现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkPrin-12       7168467        157 ns&#x2F;op       64 B&#x2F;op        3 allocs&#x2F;op</span><br><span class="line">BenchmarkPlus -12     43278558         26.7 ns&#x2F;op        0 B&#x2F;op        0 allocs&#x2F;op</span><br></pre></td></tr></table></figure>
<p><strong>使用 + 进行字符串拼接，不会在堆上产生额外对象。****而使用 fmt 系列函数，则会造成局部对象逃逸到堆上，这里是高频路径上有大量逃逸，所以导致线上服务的 GC 压力加重，大量接口超时。</strong></p>
<p>出于谨慎考虑，修改高并发接口时，拿不准的尽量都应进行简单的线下 benchmark 测试。</p>
<p>当然，我们不能指望靠写一大堆 benchmark 帮我们发现系统的瓶颈。</p>
<p><strong>实际工作中还是要使用前文提到的优化工作流来进行系统性能优化。也就是尽量从接口整体而非函数局部考虑去发现与解决瓶颈。</strong></p>
<h2 id="宏观性能优化"><a href="#宏观性能优化" class="headerlink" title="宏观性能优化"></a>宏观性能优化</h2><p>接口类的服务，我们可以使用两种方式对其进行压测：</p>
<ul>
<li><p>固定 QPS 压测：在每次系统有大的特性发布时，都应进行固定 QPS 压测，<strong>与历史版本进行对比，****需要关注的指标包括，相同 QPS 下的系统的 CPU 使用情况，内存占用情况(监控中的 RSS 值)，goroutine 数，GC 触发频率和相关指标(是否有较长的 stw，mark 阶段是否时间较长等)，平均延迟，p99 延迟。</strong></p>
</li>
<li><p>极限 QPS 压测：极限 QPS 压测一般只是为了 benchmark show，没有太大意义。系统满负荷时，基本 p99 已经超出正常用户的忍受范围了。</p>
</li>
</ul>
<p>压测过程中需要采集不同 QPS 下的 CPU profile，内存 profile，记录 goroutine 数。与历史情况进行 AB 对比。</p>
<p>Go 的 pprof 还提供了 –base 的 flag，能够很直观地帮我们发现不同版本之间的指标差异：用 pprof 比较内存使用差异[6]。</p>
<p><strong>总之记住一点，接口的性能一定是通过压测来进行优化的，而不是通过硬啃代码找瓶颈点。****关键路径的简单修改往往可以带来巨大收益。如果只是啃代码，很有可能将 1% 优化到 0%，优化了 100% 的局部性能，对接口整体影响微乎其微。</strong></p>
<h2 id="寻找性能瓶颈"><a href="#寻找性能瓶颈" class="headerlink" title="寻找性能瓶颈"></a>寻找性能瓶颈</h2><p>在压测时，我们通过以下步骤来逐渐提升接口的整体性能：</p>
<ul>
<li><p>使用固定 QPS 压测，以阶梯形式逐渐增加压测 QPS，如 1000 -&gt; 每分钟增加 1000 QPS</p>
</li>
<li><p>压测过程中观察系统的延迟是否异常</p>
</li>
<li><p>观察系统的 CPU 使用情况</p>
</li>
<li><p>如果 CPU 使用率在达到一定值之后不再上升，反而引起了延迟的剧烈波动，这时大概率是发生了阻塞，进入 pprof 的 web 页面，点击 goroutine，查看 top 的 goroutine 数，这时应该有大量的 goroutine 阻塞在某处，比如 Semacquire</p>
</li>
<li><p>如果 CPU 上升较快，未达到预期吞吐就已经过了高水位，则可以重点考察 CPU 使用是否合理，<strong>在 CPU 高水位进行 profile 采样，重点关注火焰图中较宽的“平顶山”</strong></p>
</li>
<li><p>重复上述步骤，直至系统性能达到或超越我们设置的性能目标。</p>
</li>
</ul>
<h2 id="一些优化案例"><a href="#一些优化案例" class="headerlink" title="一些优化案例"></a>一些优化案例</h2><h3 id="gc-mark-占用过多-CPU"><a href="#gc-mark-占用过多-CPU" class="headerlink" title="gc mark 占用过多 CPU"></a>gc mark 占用过多 CPU</h3><p>在 Go 语言中 gc mark 占用的 CPU 主要和运行时的对象数相关，也就是我们需要看 inuse_objects。</p>
<p>定时任务，或访问流量不规律的应用，需要关注 alloc_objects。</p>
<p>优化主要是下面几方面：</p>
<h3 id="减少变量逃逸"><a href="#减少变量逃逸" class="headerlink" title="减少变量逃逸"></a>减少变量逃逸</h3><p><strong>尽量在栈上分配对象，关于逃逸的规则，可以查看</strong> Go 编译器代码中的逃逸测试部分：</p>
<p><img src="https://gitee.com/psycho1900/miss-reddle/raw/master/process/%E4%BC%98%E5%8C%9602.png"></p>
<p>查看某个 package 内的逃逸情况，可以使用 build + 全路径的方式，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -gcflags&#x3D;&quot;-m -m&quot; github.com&#x2F;cch123&#x2F;elasticsql</span><br></pre></td></tr></table></figure>
<p>需要注意的是，逃逸分析的结果是会随着版本变化的，所以去背诵网上逃逸相关的文章结论是没有什么意义的。</p>
<h3 id="使用-sync-Pool-复用堆上对象"><a href="#使用-sync-Pool-复用堆上对象" class="headerlink" title="使用 sync.Pool 复用堆上对象"></a>使用 sync.Pool 复用堆上对象</h3><p>sync.Pool 用出花儿的就是 fasthttp 了，可以看看我之前写的这一篇：fasthttp 为什么快[7]。</p>
<p>最简单的复用就是复用各种 struct，slice，<strong>在复用时 put 时，需要判断 size 是否已经扩容过头，小心因为 sync.Pool 中存了大量的巨型对象导致进程占用了大量内存</strong></p>
<h3 id="调度占用过多-CPU"><a href="#调度占用过多-CPU" class="headerlink" title="调度占用过多 CPU"></a>调度占用过多 CPU</h3><p>goroutine 频繁创建与销毁会给调度造成较大的负担，如果我们发<strong>现 CPU 火焰图中 schedule，findrunnable 占用了大量 CPU，那么可以考虑使用开源的 workerpool 来进行改进，比较典型的 fasthttp worker pool[8]。</strong></p>
<p><strong>如果客户端与服务端之间使用的是短连接，那么我们可以使用长连接来减少连接创建的开销，这里就包含了 goroutine 的创建与销毁。</strong></p>
<h3 id="进程占用大量内存"><a href="#进程占用大量内存" class="headerlink" title="进程占用大量内存"></a>进程占用大量内存</h3><p>当前大多数的业务后端服务是不太需要关注进程消耗的内存的。</p>
<p><strong>我们经常看到做 Go 内存占用优化的是在网关(包括 mesh)、存储系统这两个场景。</strong></p>
<p>对于网关类系统来说，Go 的内存占用主要是因为 Go 独特的抽象模型造成的，这个很好理解：<br><img src="https://gitee.com/psycho1900/miss-reddle/raw/master/process/%E4%BC%98%E5%8C%9603.png"></p>
<p>海量的连接加上海量的 goroutine，使网关和 mesh 成为 Go OOM 的重灾区。所以网关侧的优化一般就是优化：</p>
<ul>
<li><p>goroutine 占用的栈内存</p>
</li>
<li><p>read buffer 和 write buffer 占用的内存</p>
</li>
</ul>
<p>很多项目都有相关的分享，这里就不再赘述了。</p>
<p><strong>对于存储类系统来说，内存占用方面的不少努力也是在优化各种 buffer</strong>，比如 dgraph 使用 cgo + jemalloc 来优化他们的产品内存占用[9]。</p>
<p>堆外内存不会在 Go 的 GC 系统里进行管辖，所以也不会影响到 Go 的 GC Heap Goal，所以不会因为分配大量对象造成 Go 的 Heap Goal 被推高，系统整体占用的 RSS 也被推高。</p>
<h3 id="锁冲突严重，导致吞吐量瓶颈"><a href="#锁冲突严重，导致吞吐量瓶颈" class="headerlink" title="锁冲突严重，导致吞吐量瓶颈"></a>锁冲突严重，导致吞吐量瓶颈</h3><p>我在 几个 Go 系统可能遇到的锁问题[10] 中分享过实际的线上 case。</p>
<p><strong>进行锁优化的思路无非就一个“拆”和一个“缩”字：</strong></p>
<ul>
<li><p>拆：将锁粒度进行拆分，<strong>比如全局锁，我能不能把锁粒度拆分为连接粒度的锁</strong>；<strong>如果是连接粒度的锁，那我能不能拆分为请求粒度的锁</strong>；在 logger fd 或 net fd 上加的锁不太好拆，那么我们增加一些客户端，比如从 1-&gt; 100，降低锁的冲突是不是就可以了。</p>
</li>
<li><p>缩：<strong>缩小锁的临界区，业务允许的前提下，可以把 syscall 移到锁外面</strong>；<strong>有时只是想要锁 map 的读写逻辑，但是却不小心锁了连接读写的逻辑，或许简单地用 sync.Map 来代替 map Lock</strong>，defer Unlock 就能简单地缩小临界区了。</p>
</li>
</ul>
<h3 id="timer-相关函数占用大量-CPU"><a href="#timer-相关函数占用大量-CPU" class="headerlink" title="timer 相关函数占用大量 CPU"></a>timer 相关函数占用大量 CPU</h3><p>同样是在网关和海量连接的应用中较常见，优化手段：</p>
<ul>
<li><p>使用时间轮/粗粒度的时间管理，精确到 ms 级一般就足够了</p>
</li>
<li><p>升级到 Go 1.14+，享受官方的升级红利</p>
</li>
</ul>
<h2 id="模拟真实工作负载"><a href="#模拟真实工作负载" class="headerlink" title="模拟真实工作负载"></a>模拟真实工作负载</h2><p>在前面的论述中，我们对问题进行了简化。真实世界中的后端系统往往不只一个接口，压测工具、平台往往只支持单接口压测。</p>
<p>公司的业务希望知道的是后端系统整体性能，即这些系统作为一个整体，在限定的资源条件下，能够承载多少业务量(如并发创建订单)而不崩溃。</p>
<p>虽然大家都在讲微服务，但单一服务往往也不只有单一功能，如果一个系统有 10 个接口(已经算是很小的服务了)，那么这个服务的真实负载是很难靠人肉去模拟的。</p>
<p>这也就是为什么互联网公司普遍都需要<strong>做全链路压测。</strong>像样点的公司会定期进行全链路压测演练，以便知晓随着系统快速迭代变化，系统整体是否出现了严重的性能衰退。</p>
<p>通过真实的工作负载，我们才能发现真实的线上性能问题。讲全链路压测的文章也很多，本文就不再赘述了。</p>
<h2 id="当前性能问题定位工具的局限性"><a href="#当前性能问题定位工具的局限性" class="headerlink" title="当前性能问题定位工具的局限性"></a>当前性能问题定位工具的局限性</h2><p>本文中几乎所有优化手段都是通过 Benchmark 和压测来进行的，但真实世界的软件还会有下列场景：</p>
<ul>
<li>做 ToB 生意，我们的应用是部署在客户侧(比如一些数据库产品)，客户说我们的应用会 OOM，但是我们很难拿到 OOM 的现场，不知道到底是哪些对象分配导致了 OOM</li>
</ul>
<p>(toB即面向企业， toC即面向普通用户)</p>
<ul>
<li>做大型平台，平台上有各种不同类型的用户编写代码，升级用户代码后，线上出现各种 CPU 毛刺和 OOM 问题</li>
</ul>
<p>这些问题在压测中是发现不了的，需要有更为灵活的工具和更为强大的平台，关于这些问题，我将在 4 月 10 日的武汉 Gopher Meetup 上进行分享，欢迎关注。</p>
<p>推荐阅读：cache contention[11]</p>
<p>every-programmer-should-know[12]</p>
<p>go-perfbook[13]</p>
<p>Systems Performance[14]</p>
<p>[1]<br>latency numbers every programmer should know: <a target="_blank" rel="noopener" href="https://colin-scott.github.io/personal_website/research/interactive_latency.html">https://colin-scott.github.io/personal_website/research/interactive_latency.html</a></p>
<p>[2]<br>rockstar thanks gta online player who fixed poor load times: <a target="_blank" rel="noopener" href="https://www.pcgamer.com/rockstar-thanks-gta-online-player-who-fixed-poor-load-times-official-update-coming/">https://www.pcgamer.com/rockstar-thanks-gta-online-player-who-fixed-poor-load-times-official-update-coming/</a></p>
<p>[3]<br>how I cut GTA Online loading times by 70%: <a target="_blank" rel="noopener" href="https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/">https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/</a></p>
<p>[4]<br>long stw: <a target="_blank" rel="noopener" href="https://github.com/golang/go/issues/19378">https://github.com/golang/go/issues/19378</a></p>
<p>[5]<br>gc trace 阻塞调度: <a target="_blank" rel="noopener" href="http://xiaorui.cc/archives/6232">http://xiaorui.cc/archives/6232</a></p>
<p>[6]<br>用 pprof 比较内存使用差异: <a target="_blank" rel="noopener" href="https://colobu.com/2019/08/20/use-pprof-to-compare-go-memory-usage/">https://colobu.com/2019/08/20/use-pprof-to-compare-go-memory-usage/</a></p>
<p>[7]<br>fasthttp 为什么快: <a target="_blank" rel="noopener" href="https://xargin.com/why-fasthttp-is-fast-and-the-cost-of-it/">https://xargin.com/why-fasthttp-is-fast-and-the-cost-of-it/</a></p>
<p>[8]<br>fasthttp worker pool: <a target="_blank" rel="noopener" href="https://github.com/valyala/fasthttp/blob/master/workerpool.go#L19">https://github.com/valyala/fasthttp/blob/master/workerpool.go#L19</a></p>
<p>[9]<br>内存占用: <a target="_blank" rel="noopener" href="https://dgraph.io/blog/post/manual-memory-management-golang-jemalloc/">https://dgraph.io/blog/post/manual-memory-management-golang-jemalloc/</a></p>
<p>[10]<br>几个 Go 系统可能遇到的锁问题: <a target="_blank" rel="noopener" href="https://xargin.com/lock-contention-in-go/">https://xargin.com/lock-contention-in-go/</a></p>
<p>[11]<br>cache contention: <a target="_blank" rel="noopener" href="https://web.eecs.umich.edu/~zmao/Papers/xu10mar.pdf">https://web.eecs.umich.edu/~zmao/Papers/xu10mar.pdf</a></p>
<p>[12]<br>every-programmer-should-know: <a target="_blank" rel="noopener" href="https://github.com/mtdvio/every-programmer-should-know">https://github.com/mtdvio/every-programmer-should-know</a></p>
<p>[13]<br>go-perfbook: <a target="_blank" rel="noopener" href="https://github.com/dgryski/go-perfbook">https://github.com/dgryski/go-perfbook</a></p>
<p>[14]<br>Systems Performance: <a target="_blank" rel="noopener" href="https://www.amazon.com/Systems-Performance-Brendan-Gregg/dp/0136820158/ref=sr_1_1?dchild=1&amp;keywords=systems+performance&amp;qid=1617092159&amp;sr=8-1">https://www.amazon.com/Systems-Performance-Brendan-Gregg/dp/0136820158/ref=sr_1_1?dchild=1&amp;keywords=systems+performance&amp;qid=1617092159&amp;sr=8-1</a></p>
</div><div class="tags"><a href="/tags/golang%E4%BC%98%E5%8C%96/"><i class="fa fa-tag"></i>golang优化</a></div><div class="post-nav"><a class="pre" href="/2021/08/22/runtime%E5%8C%85/">runtime包</a><a class="next" href="/2021/08/22/sync%E5%8C%85%EF%BC%88%E4%B8%8B%E9%9B%A8%E5%A4%A9%E7%AA%81%E7%84%B6%E6%83%B3%E8%B5%B7%E7%9A%84%E4%B8%80%E4%B8%AA%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%89/">sync包（下雨天突然想起的一个知识点）</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://riddlego.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo%E5%8D%9A%E5%AE%A2/">Hexo博客</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zigbee-ZStack-CC2530/">Zigbee-ZStack-CC2530</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-More/">golang-More</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang-More/Go-Modules/">Go-Modules</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-More/%E4%BC%98%E5%8C%96/">优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-More/%E5%B9%B6%E5%8F%91/">并发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-More/%E5%BA%95%E5%B1%82/">底层</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-More/%E6%B5%8B%E8%AF%95/">测试</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-More/%E7%BC%96%E7%A0%81%E8%B4%A8%E9%87%8F%E6%8F%90%E5%8D%87/">编码质量提升</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-more/">golang-more</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang-more/Go-Modules/">Go-Modules</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang-web/">golang-web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E5%8C%85%E5%8C%85/">golang包包</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E5%9F%BA%E7%A1%80/">golang基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E5%BE%AE%E6%9C%8D%E5%8A%A1/">golang微服务</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E5%BE%AE%E6%9C%8D%E5%8A%A1/RPC%E7%B3%BB%E5%88%97/">RPC系列</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E8%AF%A6%E8%A7%A3/">golang微服务相关知识详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E6%83%B3%E6%9B%B4%E6%96%B0%E5%B0%B1%E6%9B%B4%E6%96%B0%E7%9A%84%E7%A6%BB%E6%95%A3%E7%9F%A5%E8%AF%86/">golang想更新就更新的离散知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E6%95%B0%E6%8D%AE%E5%BA%93/">golang数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">golang数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E7%A2%8E%E7%A2%8E%E5%BF%B5/">golang碎碎念</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">golang设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E9%9D%A2%E8%AF%95/">golang面试</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang%E9%A1%B9%E7%9B%AE/">golang项目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/open-your-eyes/">open your eyes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/wifi/">wifi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91/">云</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%91%E6%8C%87offer/">剑指offer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">加密算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%95%E7%89%87%E6%9C%BA%E7%BC%96%E7%A8%8B/">单片机编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%89%9B%E5%AE%A2%E7%83%AD%E9%A2%98132/">牛客热题132</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%89%A9%E8%81%94%E7%BD%91APP/">物联网APP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8C%9B%E7%94%B7%E6%97%A5%E8%AE%B0/">猛男日记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80-shell/">脚本语言-shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">软件工程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E5%90%88%E9%9B%86/">面试合集</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/%E6%88%92%E7%83%9F/" style="font-size: 15px;">戒烟</a> <a href="/tags/5G/" style="font-size: 15px;">5G</a> <a href="/tags/AD7747/" style="font-size: 15px;">AD7747</a> <a href="/tags/CC2530/" style="font-size: 15px;">CC2530</a> <a href="/tags/%E6%B5%8B%E7%94%B5%E5%AE%B9/" style="font-size: 15px;">测电容</a> <a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/Bug/" style="font-size: 15px;">Bug</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/APP/" style="font-size: 15px;">APP</a> <a href="/tags/BLE/" style="font-size: 15px;">BLE</a> <a href="/tags/cc2530/" style="font-size: 15px;">cc2530</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 15px;">单片机</a> <a href="/tags/BUG/" style="font-size: 15px;">BUG</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 15px;">随笔</a> <a href="/tags/Go-Modules/" style="font-size: 15px;">Go-Modules</a> <a href="/tags/interface/" style="font-size: 15px;">interface</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/golang%E4%BC%98%E5%8C%96/" style="font-size: 15px;">golang优化</a> <a href="/tags/CLI/" style="font-size: 15px;">CLI</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/go-micro/" style="font-size: 15px;">go-micro</a> <a href="/tags/gin/" style="font-size: 15px;">gin</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 15px;">微服务</a> <a href="/tags/map/" style="font-size: 15px;">map</a> <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 15px;">云原生</a> <a href="/tags/WaitGroup/" style="font-size: 15px;">WaitGroup</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 15px;">测试</a> <a href="/tags/%E4%BB%A4%E7%89%8C%E6%A1%B6/" style="font-size: 15px;">令牌桶</a> <a href="/tags/gRPC/" style="font-size: 15px;">gRPC</a> <a href="/tags/viper/" style="font-size: 15px;">viper</a> <a href="/tags/zap/" style="font-size: 15px;">zap</a> <a href="/tags/GORM/" style="font-size: 15px;">GORM</a> <a href="/tags/WorkerPool/" style="font-size: 15px;">WorkerPool</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">计算机网络</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15px;">面试</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/IP/" style="font-size: 15px;">IP</a> <a href="/tags/DNS/" style="font-size: 15px;">DNS</a> <a href="/tags/JWT/" style="font-size: 15px;">JWT</a> <a href="/tags/token/" style="font-size: 15px;">token</a> <a href="/tags/%E9%AA%8C%E8%AF%81/" style="font-size: 15px;">验证</a> <a href="/tags/KVM/" style="font-size: 15px;">KVM</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" style="font-size: 15px;">虚拟化</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 15px;">云计算</a> <a href="/tags/OTP/" style="font-size: 15px;">OTP</a> <a href="/tags/Pcap01/" style="font-size: 15px;">Pcap01</a> <a href="/tags/OneNet-APP/" style="font-size: 15px;">OneNet-APP</a> <a href="/tags/pyqt/" style="font-size: 15px;">pyqt</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/QTableView/" style="font-size: 15px;">QTableView</a> <a href="/tags/QLineEdit/" style="font-size: 15px;">QLineEdit</a> <a href="/tags/DataFream/" style="font-size: 15px;">DataFream</a> <a href="/tags/C/" style="font-size: 15px;">C++</a> <a href="/tags/ctypes/" style="font-size: 15px;">ctypes</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/SSL/" style="font-size: 15px;">SSL</a> <a href="/tags/TSL/" style="font-size: 15px;">TSL</a> <a href="/tags/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" style="font-size: 15px;">加密算法</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 15px;">安全</a> <a href="/tags/%E6%8A%A5%E6%96%87/" style="font-size: 15px;">报文</a> <a href="/tags/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/" style="font-size: 15px;">流量控制</a> <a href="/tags/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6/" style="font-size: 15px;">拥塞控制</a> <a href="/tags/%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0/" style="font-size: 15px;">快速重传</a> <a href="/tags/%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D/" style="font-size: 15px;">快速恢复</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2/" style="font-size: 15px;">文件转换</a> <a href="/tags/Zigbee/" style="font-size: 15px;">Zigbee</a> <a href="/tags/Z-wave/" style="font-size: 15px;">Z-wave</a> <a href="/tags/cookie/" style="font-size: 15px;">cookie</a> <a href="/tags/session/" style="font-size: 15px;">session</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" style="font-size: 15px;">浏览器工作原理</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/url/" style="font-size: 15px;">url</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1/" style="font-size: 15px;">代码托管</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 15px;">工程化</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 15px;">数据结构</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 15px;">框架</a> <a href="/tags/golang%E5%9F%BA%E7%A1%80/" style="font-size: 15px;">golang基础</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size: 15px;">数据类型</a> <a href="/tags/benchmark/" style="font-size: 15px;">benchmark</a> <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" style="font-size: 15px;">单元测试</a> <a href="/tags/%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/" style="font-size: 15px;">基准测试</a> <a href="/tags/sort%E6%8E%92%E5%BA%8F/" style="font-size: 15px;">sort排序</a> <a href="/tags/%E5%A0%86/" style="font-size: 15px;">堆</a> <a href="/tags/%E6%A0%88/" style="font-size: 15px;">栈</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/" style="font-size: 15px;">多线程与并发</a> <a href="/tags/math%E5%8C%85/" style="font-size: 15px;">math包</a> <a href="/tags/%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/" style="font-size: 15px;">数学公式</a> <a href="/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" style="font-size: 15px;">垃圾回收</a> <a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/" style="font-size: 15px;">三色标记法</a> <a href="/tags/GPM%E8%B0%83%E5%BA%A6%E6%A8%A1%E5%9E%8B/" style="font-size: 15px;">GPM调度模型</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/10/20/next-zhenxi/">next-zhenxi</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/20/%E6%AF%8F%E5%A4%A9%E9%83%BD%E5%9C%A8%E5%AD%A6%E4%BC%9A%E5%91%8A%E5%88%AB/">每天都在学会告别</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/20/%E7%AE%97%E6%B3%95%E6%80%8E%E6%A0%B7%E5%AD%A6%E4%B9%A0/">算法怎样学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/20/all-pass%E7%AE%80%E5%8E%86/">all-pass简历</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/10/wifi%E6%9C%80%E8%BF%91%E8%A6%81%E7%9C%8B%E7%9C%8B/">wifi入门基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/27/namespace/">namespace</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/27/Go%E5%8D%95%E6%B5%8B%E4%BB%8E%E9%9B%B6%E5%88%B0%E6%BA%9C%E7%B3%BB%E5%88%97/">Go单测从零到溜系列</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/26/python%E8%B0%83%E7%94%A8C++%E4%BB%A3%E7%A0%81%E6%AD%A5%E9%AA%A4%E8%AF%A6%E8%A7%A3/">python调用C++代码步骤详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/11/Go%EF%BC%9A%E8%AF%B4%E8%AF%B4fanIn%E5%92%8CfanOut%E6%A8%A1%E5%BC%8F/">Go：说说fanIn和fanOut模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/11/Go-Module%E6%95%99%E7%A8%8B%E7%AC%AC5%E9%83%A8%E5%88%86%EF%BC%9AVendoring/">Go-Module教程第5部分：Vendoring</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">RiddleGo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>